# 存储引擎面试题



## 1、说一说执行一条查询SQL语句的过程

MySQL执行一条SQL会经过 连接器、查询缓存、解析器、优化器、执行器、存储引擎这些模块。

1. MySQL的连接器会进行用户身份的校验，
2. MySQL会在查询缓存中查找数据，如果命中，直接返回数据给客户端。否则继续往下执行。不过在MySQL 8 之后的版本，这一步被删除掉了，原因是因为，如果对表中的数据进行更新操作，那么这张表的查询缓存就会失效，所以在实际的应用场景中命中率并不高。
3. 解析器会对SQL 语句进行词法分析和语法分析，构建语法树。
4. 优化器会基于查询成本的考虑，选择成本最低的查询计划。
5. 执行器根据会根据查询计划，从存储引擎中读取数据，返回给客户端。

## 2、MySQL的存储引擎有哪些？

MySQL常见的存储引擎有 InnoDB、MyISAM、Memory

我比较熟悉的是InnoDB引擎，它是MySQL的默认存储引擎，支持事务和行级锁，具有事务提交、回滚和崩溃恢复功能

MyISAM 引擎我没有用过，但是我在学习的时候了解过，它是不支持事务和行级锁的

Memory引擎我了解的不是很多，知道它是将数据存储在内存中的，所以数据的读写时比较快的，但是数据不具备持久性，我觉得适用于临时存储数据的场景。

## 3、MyISAM 和 InnoDB有什么区别？

InnoDB 和 MyISAM 在存储结构上有很大区别，InnoDB 采用的是索引组织表，索引和数据都存储在一个文件中。

而MyISAM 采用的是堆表的方式，索引和数据分别存储在两个不同的文件中。

索引组织表有两个优势：

* 索引组织表将索引和数据到存在一个B+ 树种，相比非聚簇索引每次都需要回表，因此聚簇索引比非聚簇索引查询数据会更快
* 在索引组织表中，如果记录发生了修改吗，则其他索引无须进行维护，而当堆表的数据发生改变且位置发生变更，那么所有索引中的地址都需要更新，非常影响性能

另外，InnoDB 支持行级锁和事务，而MyISAM 只支持表锁

## 4、MySQL为什么选择InnoDB作为默认引擎？

最重要的原因是因为InnoDB支持事务，可以进行ACID属性的操作。

第二个是并发性能，InnoDB采用行级锁定的机制，可以提供更好的并发性能，MyISAM 只支持表锁，锁的粒度比较大。

第三个是崩溃恢复，InnoDB通过 redo log 日志实现了崩溃恢复，可以在数据库发生异常情况的时候，通过日志文件进行恢复，保证数据的持久性和一致性。

## 5、用count(*) 哪个存储引擎会更快？

如果查询语句没有 where 条件的话，用MyISAM 会比较快，因为MyISAM 的每张表，都会用一个变量存储表的所有记录，执行 count(*) 的时候，直接读取这个变量就行了，而InnoDB 执行的时候，需要通过遍历的方式来统计记录个数。

如果有where 查询条件的话，MyISAM 和 InnoDB 性能都差不多吗，都需要根据查询条件进行遍历

## 6、MySQL中的 NULL 值是怎么存储的？

MySQL行格式中会用 **NULL值列表** 来标记值为 NULL 的列，如果列的值为 NULL ，就会标记二进制位为 1 ，否则为 0，所以 NULL 值并不会存储在行格式中的真实数据部分。

NULL 值列表最少会占用 1 字节空间，当表中所有列都定义为 NOT NULL ，行格式中就不会有 NULL 值列表，这样至少可以节省 1 字节的空间

## 7、char 和 varchar 的区别？

char 是固定长度的字符串类型，在数据库中占用固定的存储空间，如果实际存储的字符串长度小于定义的长度，系统会用空格填充。

varchar 是可变长度的字符串类型，实际存储时只占用实际字符串长度的空间，并且还会有 1~2 字节存储长度信息

**性能差别：**站在CPU角度看，理论上char 比 varchar 更快，因为 char 是固定长度的，而varchar 需要增加一个长度标识，处理时需要多一次运算。

但是影响性能的因素有很多，当 InnoDB buffer pool 小于表大小时，“磁盘读写” 成为了性能的关键因素，而 varchar 更短，性能比较高。当 InnoDB buffer pool 足够大时，char 和 varchar 性能没有太大差别。

## 8、查询缓存 与 buffer pool 的区别

* 缓存内容：缓冲池缓存的是数据页和索引页，而查询缓存缓存的是查询结果集。
* 作用机制：缓冲池通过减少磁盘IO来提高数据读取性能，而查询缓存通过避免重新执行查询语句来提高响应速度

## 9、假如说一个字段是 varchar(10) ,但其实之后6字节，那他在内存中占的存储空间是多少？在文件中占的存储空间是多少？

内存会占用 10 字节，文件存储空间会占用 6 字节，并且还会额外 用 1~2 字节存储 长度信息

> 内存会按varchar 最大值来固定分配大小

## 10、如果硬件内存特别大，MySQL缓存是否能替代 redis?

我觉得不能替代。

MySQL是面向磁盘而设计的数据库，redis 是面向内存设计的数据库。MySQL在内存查询一个数据页的时候，都需要先查页表，也就是需要查 B+ 树，而redis 是不用的，所以还是 redis 的性能更好。

