## 执行一条select语句，期间发生了什么

MySQL的架构共分为两层：Server层和存储引擎层

* Server层负责建立连接、分析和执行SQL

​		MySQL大多数的功能都在这个层实现，主要有连接器、查询缓存、解析器、预处理器、优化器、执行器等。

* 存储引擎层负责数据的存储和提取

​		支持InnoDB、MyISAM、Memory等多个存储引擎，不同的存储引擎共用一个Server层。MySQL 5.5开始，InnoDB成为MySQL的默认存储引擎。InnoDB默认使用B+树索引类型

### 第一步：连接器

先通过连接器进行权限校验

### 第二步：查询缓存

在MySQL8版本之前有查询缓存这一步，如果SQL是查询语句，MySQL先去查询缓存里查找缓存数据，如果查询缓存里有，直接返回value给客户端。如果没有，继续往下执行。

对于更新比较频繁的表，查询缓存的命中率很低，因为只要有一个表有更新操作，这个表的查询缓存就会被清空。所以MySQL8之后查询缓存这一步就被删掉了。

### 第三步：解析SQL

解析器会做两件事：

* 词法分析：识别输入的关键字
* 语法分析：符合语法，则构建SQL语法树

### 执行SQL

* 预处理器：主要检查查询语句中的表或字段是否存在
* 优化器：如果表里有多个索引，优化器会根据查询成本的考虑，决定选择使用哪个索引。
* 执行器：主键索引、全表扫描、索引下推

返回结果集给客户端

2024年11月1日